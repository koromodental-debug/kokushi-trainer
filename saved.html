<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>問題一覧 - 国試トレーナー</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="app">
    <!-- ヘッダー (認証時はJSで上書き) -->
    <header class="header" id="app-header">
      <a href="index.html" class="header-back">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
        戻る
      </a>
      <h1 class="header-title">問題一覧</h1>
      <div style="width: 60px;"></div>
    </header>

    <!-- メインコンテンツ -->
    <main class="main-content">
      <!-- ローディング -->
      <section id="loading-state" class="section">
        <div class="card">
          <div class="loading-container">
            <div class="spinner-large"></div>
            <p>問題を読み込んでいます...</p>
          </div>
        </div>
      </section>

      <!-- 統計ダッシュボード -->
      <section class="section">
        <div class="card">
          <div class="stats-dashboard">
            <div class="stats-header">
              <h2 class="section-title">問題一覧</h2>
              <span class="total-count" id="stats-total-count">0問</span>
            </div>
            <div class="stats-tree" id="stats-tree">
              <!-- 科目・テーマのツリー表示 -->
            </div>
          </div>
        </div>
      </section>

      <!-- フィルター＆アクション -->
      <section class="section">
        <div class="card">
          <div class="filter-bar">
            <select id="filter-subject" class="form-select filter-select">
              <option value="">すべての科目</option>
            </select>
            <select id="filter-theme" class="form-select filter-select" disabled>
              <option value="">すべてのテーマ</option>
            </select>
            <button id="filter-clear-btn" class="btn btn-secondary btn-sm">クリア</button>
          </div>

          <div class="search-bar">
            <input type="search" id="search-input" class="search-input" placeholder="問題文・選択肢・解説で検索...">
          </div>

          <div class="saved-actions-bar">
            <button id="expand-all-btn" class="btn btn-secondary btn-sm">すべて展開</button>
            <button id="collapse-all-btn" class="btn btn-secondary btn-sm">すべて折りたたみ</button>
            <button id="start-filtered-exam-btn" class="btn btn-accent btn-sm">模擬試験</button>
            <button id="create-set-btn" class="btn btn-warning btn-sm">問題セットに追加</button>
            <div class="saved-actions-right">
              <button id="export-csv-btn" class="btn btn-secondary btn-sm">CSV</button>
              <button id="export-json-btn" class="btn btn-secondary btn-sm">JSON</button>
            </div>
          </div>

          <!-- フィルター結果表示 -->
          <div class="filter-result" id="filter-result" hidden>
            <span id="filter-result-text">0問が該当</span>
          </div>
        </div>
      </section>

      <!-- 問題リスト -->
      <section class="section">
        <div id="questions-container">
          <!-- アコーディオン形式の問題がここに表示される -->
        </div>
      </section>

      <!-- 空状態 -->
      <section id="empty-state" class="section" hidden>
        <div class="card empty-state-card">
          <div class="empty-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="12" y1="18" x2="12" y2="12"/>
              <line x1="9" y1="15" x2="15" y2="15"/>
            </svg>
          </div>
          <h3>問題がありません</h3>
          <p>問題データを準備中です</p>
        </div>
      </section>
    </main>

    <!-- 模擬試験モード -->
    <section id="exam-section" class="section" hidden>
      <div class="card">
        <div class="exam-header">
          <h2 class="section-title">模擬試験</h2>
          <div class="exam-info">
            <span id="exam-progress">1 / 5</span>
            <span id="exam-timer">00:00</span>
          </div>
        </div>

        <div id="exam-question" class="exam-question"></div>
        <div id="exam-choices" class="exam-choices"></div>

        <div class="exam-actions">
          <button id="exam-prev-btn" class="btn btn-secondary" disabled>前の問題</button>
          <button id="exam-next-btn" class="btn btn-primary">次の問題</button>
        </div>
      </div>
    </section>

    <!-- 試験結果 -->
    <section id="exam-results-section" class="section" hidden>
      <div class="card">
        <h2 class="section-title">試験結果</h2>
        <div class="exam-score">
          <span class="score-value" id="score-value">0</span>
          <span class="score-divider">/</span>
          <span class="score-total" id="score-total">5</span>
        </div>
        <div class="score-percentage" id="score-percentage">0%</div>

        <div id="exam-review" class="exam-review"></div>

        <div class="exam-results-actions">
          <button id="retry-btn" class="btn btn-secondary">もう一度</button>
          <button id="back-to-list-btn" class="btn btn-primary">問題一覧に戻る</button>
        </div>
      </div>
    </section>
  </div>

  <!-- 問題セット作成モーダル -->
  <div id="create-set-modal" class="modal" hidden>
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">問題セットを作成</h2>
        <button id="close-create-set-btn" class="icon-btn" aria-label="閉じる">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">タイトル</label>
          <input type="text" id="set-title-input" class="form-input" placeholder="例: 第1回 基礎テスト">
        </div>
        <div class="form-group">
          <label class="form-label">説明（任意）</label>
          <input type="text" id="set-description-input" class="form-input" placeholder="例: 保存修復の基礎問題">
        </div>
        <p class="form-hint"><span id="set-question-count">0</span>問を問題セットとして保存し、共有コードを発行します。</p>
      </div>
      <div class="modal-footer">
        <button id="create-set-submit-btn" class="btn btn-primary">
          <span class="btn-text">作成する</span>
          <span class="btn-loading" hidden>
            <span class="spinner"></span>
            作成中...
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- 選択バー（フローティング） -->
  <div id="selection-bar" class="selection-bar" hidden>
    <span id="selected-count" class="selection-bar-count">0問を選択中</span>
    <div class="selection-bar-actions">
      <button id="deselect-all-btn" class="btn btn-secondary btn-sm">選択解除</button>
      <button id="create-set-selected-btn" class="btn btn-warning btn-sm">問題セットに追加</button>
      <button id="delete-selected-btn" class="btn btn-danger btn-sm">まとめて削除</button>
    </div>
  </div>

  <script type="module" src="js/saved.js"></script>
</body>
</html>
