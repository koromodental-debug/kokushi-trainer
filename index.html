<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>国試トレーナー</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="app">
    <!-- ヘッダー -->
    <header class="header">
      <h1 class="header-title">国試トレーナー</h1>
      <button id="settings-btn" class="icon-btn" aria-label="設定">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
    </header>

    <!-- メインコンテンツ -->
    <main class="main-content">
      <!-- 生成フォーム -->
      <section id="generator-form" class="section">
        <div class="card">
          <h2 class="section-title">問題を生成</h2>

          <!-- 科目選択 -->
          <div class="form-group">
            <label class="form-label">科目</label>
            <select id="subject-select" class="form-select">
              <option value="">科目を選択...</option>
            </select>
          </div>

          <!-- テーマ選択 -->
          <div class="form-group">
            <label class="form-label">テーマ</label>
            <select id="theme-select" class="form-select" disabled>
              <option value="">先に科目を選択してください</option>
            </select>
          </div>

          <!-- 問題数 -->
          <div class="form-group">
            <label class="form-label">問題数</label>
            <div class="number-input-group">
              <button type="button" class="number-btn" id="count-minus">-</button>
              <input type="number" id="question-count" class="form-input number-input" value="5" min="1" max="20">
              <button type="button" class="number-btn" id="count-plus">+</button>
            </div>
          </div>

          <!-- 難易度 -->
          <div class="form-group">
            <label class="form-label">難易度</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="difficulty" value="hisshu" checked>
                <span class="radio-text">必修レベル</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="difficulty" value="general">
                <span class="radio-text">一般レベル</span>
              </label>
            </div>
          </div>

          <!-- コスト表示 -->
          <div class="cost-info">
            <span class="cost-label">推定コスト:</span>
            <span id="cost-estimate" class="cost-value">約7.5円（5問 × 約1.5円）</span>
          </div>

          <!-- ボタングループ -->
          <div class="btn-group">
            <!-- 生成ボタン -->
            <button id="generate-btn" class="btn btn-primary" disabled>
              <span class="btn-text">APIで生成</span>
              <span class="btn-loading" hidden>
                <span class="spinner"></span>
                生成中...
              </span>
            </button>

            <!-- プロンプト生成ボタン -->
            <button id="prompt-btn" class="btn btn-secondary" disabled>
              プロンプトを生成（無料）
            </button>
          </div>
        </div>
      </section>

      <!-- プロンプト表示セクション -->
      <section id="prompt-section" class="section" hidden>
        <div class="card">
          <div class="prompt-header">
            <h2 class="section-title">生成プロンプト</h2>
            <button id="copy-prompt-btn" class="btn btn-accent btn-sm">コピー</button>
          </div>
          <p class="prompt-hint">以下のプロンプトをClaude（MAXプラン）やChatGPTに貼り付けて使用できます。</p>
          <div id="prompt-output" class="prompt-output"></div>
        </div>
      </section>

      <!-- JSONインポートセクション -->
      <section id="import-section" class="section">
        <div class="card">
          <div class="import-header">
            <h2 class="section-title">問題をインポート</h2>
            <span class="saved-count" id="saved-count">保存済み: 0問</span>
          </div>
          <p class="import-hint">MAXプランで生成したJSONをここに貼り付けて保存できます。</p>
          <textarea id="json-input" class="json-input" placeholder='{"questions": [...]} の形式で貼り付け'></textarea>
          <div class="import-actions">
            <button id="import-btn" class="btn btn-primary">インポート</button>
            <a href="saved.html" class="btn btn-secondary">保存済み問題を管理</a>
            <button id="clear-saved-btn" class="btn btn-danger btn-sm">全削除</button>
          </div>
        </div>
      </section>


      <!-- 生成結果 -->
      <section id="results-section" class="section" hidden>
        <div class="card">
          <div class="results-header">
            <h2 class="section-title">生成結果</h2>
            <div class="results-actions">
              <button id="export-csv-btn" class="btn btn-secondary btn-sm">CSVエクスポート</button>
              <button id="export-json-btn" class="btn btn-secondary btn-sm">JSONエクスポート</button>
              <button id="start-exam-btn" class="btn btn-accent btn-sm">模擬試験を開始</button>
            </div>
          </div>
          <div id="questions-list" class="questions-list">
            <!-- 生成された問題がここに表示される -->
          </div>
        </div>
      </section>

      <!-- 模擬試験モード -->
      <section id="exam-section" class="section" hidden>
        <div class="card">
          <div class="exam-header">
            <h2 class="section-title">模擬試験</h2>
            <div class="exam-info">
              <span id="exam-progress">1 / 5</span>
              <span id="exam-timer">00:00</span>
            </div>
          </div>

          <div id="exam-question" class="exam-question">
            <!-- 問題が表示される -->
          </div>

          <div id="exam-choices" class="exam-choices">
            <!-- 選択肢が表示される -->
          </div>

          <div class="exam-actions">
            <button id="exam-prev-btn" class="btn btn-secondary" disabled>前の問題</button>
            <button id="exam-next-btn" class="btn btn-primary">次の問題</button>
          </div>
        </div>
      </section>

      <!-- 試験結果 -->
      <section id="exam-results-section" class="section" hidden>
        <div class="card">
          <h2 class="section-title">試験結果</h2>
          <div class="exam-score">
            <span class="score-value" id="score-value">0</span>
            <span class="score-divider">/</span>
            <span class="score-total" id="score-total">5</span>
          </div>
          <div class="score-percentage" id="score-percentage">0%</div>

          <div id="exam-review" class="exam-review">
            <!-- 解答の振り返りが表示される -->
          </div>

          <div class="exam-results-actions">
            <button id="retry-btn" class="btn btn-secondary">もう一度</button>
            <button id="new-exam-btn" class="btn btn-primary">新しい問題を生成</button>
          </div>
        </div>
      </section>
    </main>

    <!-- 設定モーダル -->
    <div id="settings-modal" class="modal" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">設定</h2>
          <button id="close-settings-btn" class="icon-btn" aria-label="閉じる">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <!-- APIプロバイダー選択 -->
          <div class="form-group">
            <label class="form-label">APIプロバイダー</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="provider" value="claude" checked>
                <span class="radio-text">Claude (Anthropic)</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="provider" value="gemini">
                <span class="radio-text">Gemini (Google)</span>
              </label>
            </div>
          </div>

          <!-- Claude API設定 -->
          <div id="claude-settings" class="provider-settings">
            <div class="form-group">
              <label class="form-label">Claude API Key</label>
              <input type="password" id="claude-api-key-input" class="form-input" placeholder="sk-ant-...">
              <p class="form-hint">
                <a href="https://console.anthropic.com/settings/keys" target="_blank">Anthropic Console</a>で取得
              </p>
            </div>
            <div class="form-group">
              <label class="form-label">Claudeモデル</label>
              <select id="claude-model-select" class="form-select">
                <option value="claude-sonnet-4-20250514">Claude Sonnet 4 (推奨)</option>
                <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                <option value="claude-3-haiku-20240307">Claude 3 Haiku (安価)</option>
              </select>
            </div>
          </div>

          <!-- Gemini API設定 -->
          <div id="gemini-settings" class="provider-settings" hidden>
            <div class="form-group">
              <label class="form-label">Gemini API Key</label>
              <input type="password" id="gemini-api-key-input" class="form-input" placeholder="AIza...">
              <p class="form-hint">
                <a href="https://aistudio.google.com/apikey" target="_blank">Google AI Studio</a>で取得
              </p>
            </div>
            <div class="form-group">
              <label class="form-label">Geminiモデル</label>
              <select id="gemini-model-select" class="form-select">
                <option value="gemini-2.0-flash">Gemini 2.0 Flash (推奨・安価)</option>
                <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                <option value="gemini-1.5-pro">Gemini 1.5 Pro (高性能)</option>
              </select>
            </div>
          </div>

          <p class="form-hint" style="margin-top: 16px;">APIキーはローカルに保存され、サーバーには送信されません。</p>
        </div>
        <div class="modal-footer">
          <button id="save-settings-btn" class="btn btn-primary">保存</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>
